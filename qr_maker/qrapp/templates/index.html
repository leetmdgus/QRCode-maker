<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>QR Maker</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { display:flex; min-height:100dvh; align-items:center; justify-content:center; background:#f7f7fb; margin:0; }
    .card { width:min(640px, 92vw); background:#fff; border:1px solid #e7e7ef; border-radius:16px; padding:20px 22px; box-shadow:0 6px 24px rgba(0,0,0,.06); }
    h1 { margin:0 0 12px; font-size:20px; }
    .row { display:flex; gap:10px; }
    input[type="url"], input[type="text"] {
      flex:1; padding:12px 14px; border:1px solid #dcdce6; border-radius:10px; font-size:14px;
    }
    button {
      padding:12px 16px; border:0; border-radius:10px; font-weight:600; cursor:pointer; font-size:14px;
      background:#3b82f6; color:#fff;
    }
    .hint { color:#6b7280; font-size:12px; margin-top:8px; }
    .status { margin-top:10px; font-size:13px; }
    .ok { color:#16a34a; } .err { color:#dc2626; }
    .preview { margin-top:14px; display:flex; justify-content:center; }
    .preview img { width:240px; height:240px; object-fit:contain; border:1px dashed #e5e7eb; border-radius:12px; background:#fff; }
  </style>
</head>
<body>
  <div class="card">
    <h1>QR 코드 생성기</h1>
    <div class="row" style="margin-bottom:8px;">
      <input id="urlInput" type="url" placeholder="QR 코드를 생성할 URL (예: https://example.com)" />
    </div>
    <div class="row" style="margin-bottom:8px;">
      <input id="nameInput" type="text" placeholder="다운로드 파일명 (선택, 예: myqr)" />
      <button id="previewBtn">미리보기</button>
    </div>
    <div class="row" style="margin-bottom:8px;">
      <button id="downloadBtn">다운로드</button>
    </div>
    <div class="hint">URL을 입력하고 ‘미리보기’로 이미지를 확인한 뒤, ‘다운로드’를 누르세요.</div>
    <div class="status" id="status"></div>
    <div class="preview"><img id="qrImg" alt="QR Preview" /></div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const urlInput = $("urlInput");
    const nameInput = $("nameInput");
    const statusBox = $("status");
    const qrImg = $("qrImg");
    const previewBtn = $("previewBtn");
    const downloadBtn = $("downloadBtn");

    function setStatus(msg, kind="") {
      statusBox.textContent = msg;
      statusBox.className = `status ${kind}`;
    }

    function buildPreviewUrl(u) {
      return `/qr.png?url=${encodeURIComponent(u)}`;
    }

    function buildDownloadUrl(u, filename) {
      const base = `/qr/download?url=${encodeURIComponent(u)}`;
      return filename ? `${base}&filename=${encodeURIComponent(filename)}` : base;
    }

    previewBtn.addEventListener("click", () => {
      const u = urlInput.value.trim();
      if (!u) return setStatus("URL을 입력해주세요.", "err");
      if (!/^https?:\/\//i.test(u)) return setStatus("http(s):// 로 시작하는 URL만 가능합니다.", "err");
      qrImg.src = buildPreviewUrl(u);
      setStatus("미리보기를 불러왔습니다.", "ok");
    });

    downloadBtn.addEventListener("click", () => {
      const u = urlInput.value.trim();
      let filename = nameInput.value.trim() || "qrcode";
      if (!filename.toLowerCase().endsWith(".png")) {
        filename += ".png";
      }
      if (!u) return setStatus("URL을 입력해주세요.", "err");
      if (!/^https?:\/\//i.test(u)) return setStatus("http(s):// 로 시작하는 URL만 가능합니다.", "err");

      // 그냥 링크 이동(attachment 헤더로 다운로드)
      const a = document.createElement("a");
      a.href = buildDownloadUrl(u, filename);
      a.download = filename; // 브라우저별로 무시될 수 있지만 같이 설정
      document.body.appendChild(a);
      a.click();
      a.remove();
      setStatus(`다운로드를 시작했습니다: ${filename}`, "ok");
    });

    // Enter 키로 미리보기
    urlInput.addEventListener("keydown", (e) => { if (e.key === "Enter") previewBtn.click(); });
    nameInput.addEventListener("keydown", (e) => { if (e.key === "Enter") downloadBtn.click(); });
  </script>
</body>
</html>

